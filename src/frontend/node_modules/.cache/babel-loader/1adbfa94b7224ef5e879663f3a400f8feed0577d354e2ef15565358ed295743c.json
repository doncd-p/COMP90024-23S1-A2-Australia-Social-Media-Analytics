{"ast":null,"code":"var Definable = require(\"./Definable\");\nvar zrUtil = require(\"../../core/util\");\n\n/**\n * @file Manages SVG shadow elements.\n * @author Zhang Wenli\n */\n\n/**\n * Manages SVG shadow elements.\n *\n * @class\n * @extends Definable\n * @param   {number}     zrId    zrender instance id\n * @param   {SVGElement} svgRoot root of SVG document\n */\nfunction ShadowManager(zrId, svgRoot) {\n  Definable.call(this, zrId, svgRoot, ['filter'], '__filter_in_use__', '_shadowDom');\n}\nzrUtil.inherits(ShadowManager, Definable);\n/**\n * Create new shadow DOM for fill or stroke if not exist,\n * but will not update shadow if exists.\n *\n * @param {SvgElement}  svgElement   SVG element to paint\n * @param {Displayable} displayable  zrender displayable element\n */\n\nShadowManager.prototype.addWithoutUpdate = function (svgElement, displayable) {\n  if (displayable && hasShadow(displayable.style)) {\n    // Create dom in <defs> if not exists\n    var dom;\n    if (displayable._shadowDom) {\n      // Gradient exists\n      dom = displayable._shadowDom;\n      var defs = this.getDefs(true);\n      if (!defs.contains(displayable._shadowDom)) {\n        // _shadowDom is no longer in defs, recreate\n        this.addDom(dom);\n      }\n    } else {\n      // New dom\n      dom = this.add(displayable);\n    }\n    this.markUsed(displayable);\n    var id = dom.getAttribute('id');\n    svgElement.style.filter = 'url(#' + id + ')';\n  }\n};\n/**\n * Add a new shadow tag in <defs>\n *\n * @param {Displayable} displayable  zrender displayable element\n * @return {SVGFilterElement} created DOM\n */\n\nShadowManager.prototype.add = function (displayable) {\n  var dom = this.createElement('filter'); // Set dom id with shadow id, since each shadow instance\n  // will have no more than one dom element.\n  // id may exists before for those dirty elements, in which case\n  // id should remain the same, and other attributes should be\n  // updated.\n\n  displayable._shadowDomId = displayable._shadowDomId || this.nextId++;\n  dom.setAttribute('id', 'zr' + this._zrId + '-shadow-' + displayable._shadowDomId);\n  this.updateDom(displayable, dom);\n  this.addDom(dom);\n  return dom;\n};\n/**\n * Update shadow.\n *\n * @param {Displayable} displayable  zrender displayable element\n */\n\nShadowManager.prototype.update = function (svgElement, displayable) {\n  var style = displayable.style;\n  if (hasShadow(style)) {\n    var that = this;\n    Definable.prototype.update.call(this, displayable, function () {\n      that.updateDom(displayable, displayable._shadowDom);\n    });\n  } else {\n    // Remove shadow\n    this.remove(svgElement, displayable);\n  }\n};\n/**\n * Remove DOM and clear parent filter\n */\n\nShadowManager.prototype.remove = function (svgElement, displayable) {\n  if (displayable._shadowDomId != null) {\n    this.removeDom(svgElement);\n    svgElement.style.filter = '';\n  }\n};\n/**\n * Update shadow dom\n *\n * @param {Displayable} displayable  zrender displayable element\n * @param {SVGFilterElement} dom DOM to update\n */\n\nShadowManager.prototype.updateDom = function (displayable, dom) {\n  var domChild = dom.getElementsByTagName('feDropShadow');\n  if (domChild.length === 0) {\n    domChild = this.createElement('feDropShadow');\n  } else {\n    domChild = domChild[0];\n  }\n  var style = displayable.style;\n  var scaleX = displayable.scale ? displayable.scale[0] || 1 : 1;\n  var scaleY = displayable.scale ? displayable.scale[1] || 1 : 1; // TODO: textBoxShadowBlur is not supported yet\n\n  var offsetX;\n  var offsetY;\n  var blur;\n  var color;\n  if (style.shadowBlur || style.shadowOffsetX || style.shadowOffsetY) {\n    offsetX = style.shadowOffsetX || 0;\n    offsetY = style.shadowOffsetY || 0;\n    blur = style.shadowBlur;\n    color = style.shadowColor;\n  } else if (style.textShadowBlur) {\n    offsetX = style.textShadowOffsetX || 0;\n    offsetY = style.textShadowOffsetY || 0;\n    blur = style.textShadowBlur;\n    color = style.textShadowColor;\n  } else {\n    // Remove shadow\n    this.removeDom(dom, style);\n    return;\n  }\n  domChild.setAttribute('dx', offsetX / scaleX);\n  domChild.setAttribute('dy', offsetY / scaleY);\n  domChild.setAttribute('flood-color', color); // Divide by two here so that it looks the same as in canvas\n  // See: https://html.spec.whatwg.org/multipage/canvas.html#dom-context-2d-shadowblur\n\n  var stdDx = blur / 2 / scaleX;\n  var stdDy = blur / 2 / scaleY;\n  var stdDeviation = stdDx + ' ' + stdDy;\n  domChild.setAttribute('stdDeviation', stdDeviation); // Fix filter clipping problem\n\n  dom.setAttribute('x', '-100%');\n  dom.setAttribute('y', '-100%');\n  dom.setAttribute('width', Math.ceil(blur / 2 * 200) + '%');\n  dom.setAttribute('height', Math.ceil(blur / 2 * 200) + '%');\n  dom.appendChild(domChild); // Store dom element in shadow, to avoid creating multiple\n  // dom instances for the same shadow element\n\n  displayable._shadowDom = dom;\n};\n/**\n * Mark a single shadow to be used\n *\n * @param {Displayable} displayable displayable element\n */\n\nShadowManager.prototype.markUsed = function (displayable) {\n  if (displayable._shadowDom) {\n    Definable.prototype.markUsed.call(this, displayable._shadowDom);\n  }\n};\nfunction hasShadow(style) {\n  // TODO: textBoxShadowBlur is not supported yet\n  return style && (style.shadowBlur || style.shadowOffsetX || style.shadowOffsetY || style.textShadowBlur || style.textShadowOffsetX || style.textShadowOffsetY);\n}\nvar _default = ShadowManager;\nmodule.exports = _default;","map":{"version":3,"names":["Definable","require","zrUtil","ShadowManager","zrId","svgRoot","call","inherits","prototype","addWithoutUpdate","svgElement","displayable","hasShadow","style","dom","_shadowDom","defs","getDefs","contains","addDom","add","markUsed","id","getAttribute","filter","createElement","_shadowDomId","nextId","setAttribute","_zrId","updateDom","update","that","remove","removeDom","domChild","getElementsByTagName","length","scaleX","scale","scaleY","offsetX","offsetY","blur","color","shadowBlur","shadowOffsetX","shadowOffsetY","shadowColor","textShadowBlur","textShadowOffsetX","textShadowOffsetY","textShadowColor","stdDx","stdDy","stdDeviation","Math","ceil","appendChild","_default","module","exports"],"sources":["/Users/zoyazhou/workspace/vscodeProjects/ccc_assign2/node_modules/zrender/lib/svg/helper/ShadowManager.js"],"sourcesContent":["var Definable = require(\"./Definable\");\n\nvar zrUtil = require(\"../../core/util\");\n\n/**\n * @file Manages SVG shadow elements.\n * @author Zhang Wenli\n */\n\n/**\n * Manages SVG shadow elements.\n *\n * @class\n * @extends Definable\n * @param   {number}     zrId    zrender instance id\n * @param   {SVGElement} svgRoot root of SVG document\n */\nfunction ShadowManager(zrId, svgRoot) {\n  Definable.call(this, zrId, svgRoot, ['filter'], '__filter_in_use__', '_shadowDom');\n}\n\nzrUtil.inherits(ShadowManager, Definable);\n/**\n * Create new shadow DOM for fill or stroke if not exist,\n * but will not update shadow if exists.\n *\n * @param {SvgElement}  svgElement   SVG element to paint\n * @param {Displayable} displayable  zrender displayable element\n */\n\nShadowManager.prototype.addWithoutUpdate = function (svgElement, displayable) {\n  if (displayable && hasShadow(displayable.style)) {\n    // Create dom in <defs> if not exists\n    var dom;\n\n    if (displayable._shadowDom) {\n      // Gradient exists\n      dom = displayable._shadowDom;\n      var defs = this.getDefs(true);\n\n      if (!defs.contains(displayable._shadowDom)) {\n        // _shadowDom is no longer in defs, recreate\n        this.addDom(dom);\n      }\n    } else {\n      // New dom\n      dom = this.add(displayable);\n    }\n\n    this.markUsed(displayable);\n    var id = dom.getAttribute('id');\n    svgElement.style.filter = 'url(#' + id + ')';\n  }\n};\n/**\n * Add a new shadow tag in <defs>\n *\n * @param {Displayable} displayable  zrender displayable element\n * @return {SVGFilterElement} created DOM\n */\n\n\nShadowManager.prototype.add = function (displayable) {\n  var dom = this.createElement('filter'); // Set dom id with shadow id, since each shadow instance\n  // will have no more than one dom element.\n  // id may exists before for those dirty elements, in which case\n  // id should remain the same, and other attributes should be\n  // updated.\n\n  displayable._shadowDomId = displayable._shadowDomId || this.nextId++;\n  dom.setAttribute('id', 'zr' + this._zrId + '-shadow-' + displayable._shadowDomId);\n  this.updateDom(displayable, dom);\n  this.addDom(dom);\n  return dom;\n};\n/**\n * Update shadow.\n *\n * @param {Displayable} displayable  zrender displayable element\n */\n\n\nShadowManager.prototype.update = function (svgElement, displayable) {\n  var style = displayable.style;\n\n  if (hasShadow(style)) {\n    var that = this;\n    Definable.prototype.update.call(this, displayable, function () {\n      that.updateDom(displayable, displayable._shadowDom);\n    });\n  } else {\n    // Remove shadow\n    this.remove(svgElement, displayable);\n  }\n};\n/**\n * Remove DOM and clear parent filter\n */\n\n\nShadowManager.prototype.remove = function (svgElement, displayable) {\n  if (displayable._shadowDomId != null) {\n    this.removeDom(svgElement);\n    svgElement.style.filter = '';\n  }\n};\n/**\n * Update shadow dom\n *\n * @param {Displayable} displayable  zrender displayable element\n * @param {SVGFilterElement} dom DOM to update\n */\n\n\nShadowManager.prototype.updateDom = function (displayable, dom) {\n  var domChild = dom.getElementsByTagName('feDropShadow');\n\n  if (domChild.length === 0) {\n    domChild = this.createElement('feDropShadow');\n  } else {\n    domChild = domChild[0];\n  }\n\n  var style = displayable.style;\n  var scaleX = displayable.scale ? displayable.scale[0] || 1 : 1;\n  var scaleY = displayable.scale ? displayable.scale[1] || 1 : 1; // TODO: textBoxShadowBlur is not supported yet\n\n  var offsetX;\n  var offsetY;\n  var blur;\n  var color;\n\n  if (style.shadowBlur || style.shadowOffsetX || style.shadowOffsetY) {\n    offsetX = style.shadowOffsetX || 0;\n    offsetY = style.shadowOffsetY || 0;\n    blur = style.shadowBlur;\n    color = style.shadowColor;\n  } else if (style.textShadowBlur) {\n    offsetX = style.textShadowOffsetX || 0;\n    offsetY = style.textShadowOffsetY || 0;\n    blur = style.textShadowBlur;\n    color = style.textShadowColor;\n  } else {\n    // Remove shadow\n    this.removeDom(dom, style);\n    return;\n  }\n\n  domChild.setAttribute('dx', offsetX / scaleX);\n  domChild.setAttribute('dy', offsetY / scaleY);\n  domChild.setAttribute('flood-color', color); // Divide by two here so that it looks the same as in canvas\n  // See: https://html.spec.whatwg.org/multipage/canvas.html#dom-context-2d-shadowblur\n\n  var stdDx = blur / 2 / scaleX;\n  var stdDy = blur / 2 / scaleY;\n  var stdDeviation = stdDx + ' ' + stdDy;\n  domChild.setAttribute('stdDeviation', stdDeviation); // Fix filter clipping problem\n\n  dom.setAttribute('x', '-100%');\n  dom.setAttribute('y', '-100%');\n  dom.setAttribute('width', Math.ceil(blur / 2 * 200) + '%');\n  dom.setAttribute('height', Math.ceil(blur / 2 * 200) + '%');\n  dom.appendChild(domChild); // Store dom element in shadow, to avoid creating multiple\n  // dom instances for the same shadow element\n\n  displayable._shadowDom = dom;\n};\n/**\n * Mark a single shadow to be used\n *\n * @param {Displayable} displayable displayable element\n */\n\n\nShadowManager.prototype.markUsed = function (displayable) {\n  if (displayable._shadowDom) {\n    Definable.prototype.markUsed.call(this, displayable._shadowDom);\n  }\n};\n\nfunction hasShadow(style) {\n  // TODO: textBoxShadowBlur is not supported yet\n  return style && (style.shadowBlur || style.shadowOffsetX || style.shadowOffsetY || style.textShadowBlur || style.textShadowOffsetX || style.textShadowOffsetY);\n}\n\nvar _default = ShadowManager;\nmodule.exports = _default;"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}